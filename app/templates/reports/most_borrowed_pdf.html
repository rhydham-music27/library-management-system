<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Most Borrowed Books Report</title>
  <style>
    @page { size: A4; margin: 2cm; }
    body { font-family: Arial, sans-serif; font-size: 12pt; color: #000; }
    h1 { font-size: 18pt; border-bottom: 2px solid #000; margin-bottom: 12px; padding-bottom: 6px; }
    .meta { margin-bottom: 16px; }
    .meta div { margin: 2px 0; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; font-weight: bold; }
    .small { font-size: 10pt; color: #333; }
    .footer { margin-top: 16px; text-align: right; font-size: 10pt; }
    tr:nth-child(even) { background: #fafafa; }
  </style>
</head>
<body>
  <h1>Most Borrowed Books Report</h1>
  <div class="meta">
    <div><strong>Library:</strong> Library Management System</div>
    <div><strong>Period:</strong> {{ (start_date.isoformat() if start_date else 'All time') }} to {{ (end_date.isoformat() if end_date else 'Today') }}</div>
    <div class="small"><strong>Generated on:</strong> {{ today.isoformat() }}</div>
  </div>

  <div class="small" style="margin-bottom: 8px;">
    Total books in report: {{ rows|length }}
  </div>

  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Title</th>
        <th>Author</th>
        <th>Category</th>
        <th>Times Borrowed</th>
      </tr>
    </thead>
    <tbody>
      {% for book, count in rows %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ book.title }}</td>
        <td>{{ book.author }}</td>
        <td>{{ book.category.name if book.category else 'Uncategorized' }}</td>
        <td>{{ count }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="footer">
    Generated by Library Management System
  </div>
</body>
</html>
